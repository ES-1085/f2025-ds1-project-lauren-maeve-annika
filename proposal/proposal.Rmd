---
title: "Project proposal"
author: "Lauren, Maeve, Annika"
output: github_document
---

```{r load-packages, message = FALSE}
library(tidyverse)
library(broom)
```

## 1. Introduction

The research question we're exploring is how does being the home or away team affect shots taken and shots on target?

In this project, we are using data from the Football Datasets GitHub Repository. This dataset provides detailed match statistics for all Bundesliga games in the 2024-2025 season that is taken from the Football Data UK Co website. Each row represents a single match, with information on both the home and away teams, goals scored, shot taken, scores throughout the game, fouls, etc. See README for full variables and names. 

## 2. Data

```{r dimensions}
# dim(season)
```

```{r glimpse}
season <- read_csv("../data/season.csv")
glimpse(season)

```

## 3. Data analysis plan

- What variables will you visualize to explore your research questions?

We plan to use the HS, AS, HST, AST, HomeTeam, and AwayTeam variables to visualize the question.

- Will there be any other data that you need to find to help with your research question?

No, as all of our data is in the existing dataset.

- Very preliminary exploratory data analysis, including some summary statistics and visualizations, along with some explanation on how they help you learn more about your data. 

The data visualization(s) that you believe will be useful in exploring your question(s).

 - Histograms - to compare `HomeTeam` and `AwayTeam` depending on `HS` and `AS` 

 - Density plots - to compare `HS` and `AS` with `HST` and `AST

 - Scatter plot - comparing between the two teams
 
 - Bar plots - to show a difference in `HS` and `AS`


```{r summary-stats}
season |>
  group_by(HomeTeam) |>
  summarise(
    mean_HS = mean(HS, na.rm = TRUE),
    mean_HST = mean(HST, na.rm = TRUE),
    sd_HS = sd(HS, na.rm = TRUE),
    sd_HST = sd(HST, na.rm = TRUE),
    r = cor(HS, HST, use = "complete.obs")
  )
```


```{r bar-average-shots}
team_order <- season |>
  group_by(HomeTeam) |>
  summarise(mean_HS = mean(HS, na.rm = TRUE)) |>
  arrange(desc(mean_HS)) |>
  pull(HomeTeam)

summary_long <- season |>
  group_by(HomeTeam) |>
  summarise(mean_HS = mean(HS, na.rm = TRUE),
            mean_AS = mean(AS, na.rm = TRUE)) |>
  pivot_longer(cols = c(mean_HS, mean_AS),
               names_to = "ShotType",
               values_to = "Shots")

ggplot(summary_long, aes(x = factor(HomeTeam, levels = team_order),
                         y = Shots,
                         fill = ShotType)) +
  geom_col(position = "identity", alpha = 0.7) +
  scale_fill_manual(
    values = c("mean_HS" = "goldenrod1", "mean_AS" = "palevioletred1"),
    labels = c("mean_HS" = "Average Home Shots", "mean_AS" = "Average Away Shots")
  ) +
  labs(title = "Average Home vs Away Shots per Team",
       x = "Team",
       y = "Average Shots",
       fill = "Shot Type") +
  coord_flip() +
  ylim(0, 25)

# ggsave("our_newplot.png")
```

```{r box-shot-on-target}
shots_data <- data.frame(
  ShotsOnTarget = c(season$HST, season$AST),
  Team = c(rep("Home", nrow(season)), rep("Away", nrow(season)))
)
ggplot(shots_data, aes(x = Team, y = ShotsOnTarget, fill = Team)) +
  geom_boxplot(alpha = 0.8) +
  labs(
    title = "Home vs Away Shots on Target",
    x = "Team",
    y = "Shots on Target per Match",
    fill = "Team"
  ) +
  scale_fill_manual(values = c("Home" = "goldenrod1", "Away" = "palevioletred1"))
#ggsave("our_newboxplot.png")
```


```{r foul-graph}
foul_summary <- season |>
  group_by(HomeTeam) |>
  summarise(
    mean_HF = mean(HF, na.rm = TRUE),
    mean_AF = mean(AF, na.rm = TRUE),
    discrepancy = abs(mean_HF - mean_AF)  # absolute difference
  ) |>
  ungroup()

foul_long <- foul_summary |>
  pivot_longer(
    cols = c(mean_HF, mean_AF),
    names_to = "FoulType",
    values_to = "Fouls"
  )

foul_long <- foul_long |>
  mutate(HomeTeam = factor(HomeTeam, levels = foul_summary$HomeTeam[order(-foul_summary$discrepancy)]))

ggplot(foul_long, aes(x = HomeTeam, y = Fouls, color = FoulType, group = HomeTeam)) +
  geom_line(alpha = 0.5, linewidth = 1) +
  geom_point(size = 3) +
  scale_color_manual(
      values = c("mean_HF" = "salmon", "mean_AF" = "darkturquoise"),
      labels = c("mean_HF" = "Home Team Fouls", "mean_AF" = "Away Team Fouls")
  ) +
  labs(
    title = "Average Home vs Away Fouls per Team",
    x = "Team",
    y = "Average Fouls",
    color = "Foul Type"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

#ggsave("our_newlineplot.png")
```
