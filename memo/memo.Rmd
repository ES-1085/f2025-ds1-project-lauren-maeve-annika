---
title: "Project memo"
author: "Lauren, Maeve, Annika"
output: github_document
---

```{r load-packages, message = FALSE}
library(tidyverse)
library(broom)
season <- read_csv("/cloud/project/data/season.csv")
```

## Data Clean Up Steps for Overall Data

### Step 1: Remove Referee Category

For our dataset, there were no names listed in the Referee variable and it was irrelevant for our project.

```{r remove-referee}
#season$Referee <- NULL
```

### Step 2: Check for Duplicates
```{r check-duplicates}
season <- season |>
  distinct()
```

### Step 3: Check for negatives
```{r check-negatives}
check_negatives <- season |> 
  filter(HF < 0 | AF < 0 | HS < 0 | AS < 0 | HST < 0 | AST < 0)
```

## Plots

### Plot 1: Multi-bar Plot

#### Data cleanup steps specific to plot 1

We chose these colors since they were different enough that someone can glance at the graph and see the difference with the low opacity. We wanted overlap so that each team can compare their home and away game shots taken easily.

```{r average-shots draft-one}
team_order <- season |>
  group_by(HomeTeam) |>
  summarise(mean_HS = mean(HS, na.rm = TRUE)) |>
  arrange(desc(mean_HS)) |>
  pull(HomeTeam)

summary_long <- season |>
  group_by(HomeTeam) |>
  summarise(mean_HS = mean(HS, na.rm = TRUE),
            mean_AS = mean(AS, na.rm = TRUE)) |>
  pivot_longer(cols = c(mean_HS, mean_AS),
               names_to = "ShotType",
               values_to = "Shots")

ggplot(summary_long, aes(x = factor(HomeTeam, levels = team_order),
                         y = Shots,
                         fill = ShotType)) +
  geom_col(position = "identity", alpha = 0.7) +
  scale_fill_manual(
    values = c("mean_HS" = "palevioletred1", "mean_AS" = "palevioletred3"),
    labels = c("mean_HS" = "Average Home Shots", "mean_AS" = "Average Away Shots")
  ) +
  labs(title = "Average Home vs Away Shots per Team",
       x = "Team",
       y = "Average Shots",
       fill = "Shot Type") +
  coord_flip() +
  ylim(0, 25)

#ggsave("our_newplot.png")
```

```{r multi-bar-average-shots draft-two}
team_order <- season |>
  group_by(HomeTeam) |>
  summarise(mean_HS = mean(HS, na.rm = TRUE)) |>
  arrange(desc(mean_HS)) |>
  pull(HomeTeam)
ggplot(summary_long, aes(x = factor(HomeTeam, levels = team_order),
                         y = Shots,
                         fill = ShotType)) +
  geom_col(position = "dodge", alpha = 0.8) +
  scale_fill_manual(
    values = c("mean_HS" = "palevioletred1", "mean_AS" = "cornflowerblue"),
    labels = c("mean_HS" = "Average Home Shots", "mean_AS" = "Average Away Shots")
  ) +
  labs(title = "Average Home vs Away Shots per Team",
       x = "Team",
       y = "Average Shots",
       fill = "Shot Type") +
  coord_flip() +
  ylim(0, 25)

```

Post meeting together, we weren't sure if the colors would be accessible enough for the audience so we chose a color blind friendly option and made the bars more separate.

```{r multi-bar-average-shots draft-three}
team_order <- season |>
  group_by(HomeTeam) |>
  summarise(mean_HS = mean(HS, na.rm = TRUE)) |>
  arrange(desc(mean_HS)) |>
  pull(HomeTeam)

summary_long <- season |>
  group_by(HomeTeam) |>
  summarise(mean_HS = mean(HS, na.rm = TRUE),
            mean_AS = mean(AS, na.rm = TRUE)) |>
  pivot_longer(cols = c(mean_HS, mean_AS),
               names_to = "ShotType",
               values_to = "Shots")

ggplot(summary_long, aes(x = factor(HomeTeam, levels = team_order),
                         y = Shots,
                         fill = ShotType)) +
  geom_col(position = "dodge", alpha = 0.8, width = 0.7) +
  scale_color_manual(
      values = c("mean_HS" = "salmon", "mean_AS" = "darkturquoise"),
      labels = c("mean_HF" = "Home Team Shots", "mean_AF" = "Away Team Shots")
  ) +
  labs(title = "Average Home vs Away Shots per Team",
       x = "Team",
       y = "Average Shots",
       fill = "Shot Type") +
  coord_flip() +
  ylim(0, 25)

#ggsave("our_newplot.png")
```

From plot critique two, added a subtitle that explained main takeaway of the graph as well as a more detailed title and alternative text.

#### Final Plot 1
```{r multi-bar-average-shots ggsave, fig.alt = "Multi-bar chart displaying the average shots taken by each team in the Bundesliga Soccer League. Every team except M'Gladbach and Holsteiin Kiel has more average shots when they are the home team."}
team_order <- season |>
  group_by(HomeTeam) |>
  summarise(mean_HS = mean(HS, na.rm = TRUE)) |>
  arrange(desc(mean_HS)) |>
  pull(HomeTeam)

summary_long <- season |>
  group_by(HomeTeam) |>
  summarise(mean_HS = mean(HS, na.rm = TRUE),
            mean_AS = mean(AS, na.rm = TRUE)) |>
  pivot_longer(cols = c(mean_HS, mean_AS),
               names_to = "ShotType",
               values_to = "Shots")

ggplot(summary_long, aes(x = factor(HomeTeam, levels = team_order),
                         y = Shots,
                         fill = ShotType)) +
  geom_col(position = "dodge", alpha = 0.8, width = 0.7) +
  scale_color_manual(
      values = c("mean_HS" = "salmon", "mean_AS" = "darkturquoise"),
      labels = c("mean_HS" = "Home Team Shots", "mean_AS" = "Away Team Shots")
  ) +
  labs(title = "Average Home vs Away Shots per Bundesliga Soccer Team",
       subtitle = "Teams take more shots when they are the Home Team",
       x = "Team",
       y = "Average Shots",
       fill = "Shot Type") +
  coord_flip() +
  ylim(0, 25)

#ggsave("our_newplot.png")
```

### Plot 2: Box Plot

#### Data cleanup steps specific to plot 2

```{r away-vs-home-boxplot draft-one}
shots_data <- data.frame(
  ShotsOnTarget = c(season$HST, season$AST),
  Team = c(rep("Home", nrow(season)), rep("Away", nrow(season)))
)
ggplot(shots_data, aes(x = Team, y = ShotsOnTarget, fill = Team)) +
  geom_boxplot(alpha = 0.8) +
  labs(
    title = "Home vs Away Shots on Target",
    x = "Team",
    y = "Shots on Target",
    fill = "Team"
  ) +
  scale_fill_manual(values = c("Home" = "goldenrod1", "Away" = "palevioletred1"))
#ggsave("our_newboxplot.png")
```

Changed the color to be more colorblind friendly and accessible.

```{r away-vs-home-boxplot draft-two}
shots_data <- data.frame(
  ShotsOnTarget = c(season$HST, season$AST),
  Team = c(rep("Home", nrow(season)), rep("Away", nrow(season)))
)
ggplot(shots_data, aes(x = Team, y = ShotsOnTarget, fill = Team)) +
  geom_boxplot(alpha = 0.8) +
  labs(
    title = "Home vs Away Shots on Target",
    x = "Team",
    y = "Shots on Target",
    fill = "Team"
  ) +
  scale_color_viridis_d()
#ggsave("our_newboxplot.png")
```

Following feedback from class after plot critique two, made title more detailed and added a subtitle that explained main takeaway from graph and added alternative text.

#### Final Plot 2
```{r away-vs-home-boxplot ggsave, fig.alt = "Box plot that compares away team vs home team as a whole and their shots on target. Home team has a higher average HST and greater IQR which shows that home team performs better."}
shots_data <- data.frame(
  ShotsOnTarget = c(season$HST, season$AST),
  Team = c(rep("Home", nrow(season)), rep("Away", nrow(season)))
)
ggplot(shots_data, aes(x = Team, y = ShotsOnTarget, fill = Team)) +
  geom_boxplot(alpha = 0.8) +
  labs(
    title = "Home Team vs Away Team Shots on Target",
    subtitle = "Home performs better",
    y = "Shots on Target",
    fill = "Team"
  ) +
  scale_color_viridis_d()
#ggsave("our_newboxplot.png")
```

### Plot 3: Dumbbell Plot

#### Data cleanup steps specific to plot 3

We couldn't get the colors for the colorblind scale_color_viridis to work properly so we found the closest matched colors from the given color database. We chose this plot since it showed the differences most clearly for the audience. 

```{r foul-graph draft-one}
foul_summary <- season |>
  group_by(HomeTeam) |>
  summarise(
    mean_HF = mean(HF, na.rm = TRUE),
    mean_AF = mean(AF, na.rm = TRUE),
    discrepancy = abs(mean_HF - mean_AF)
  ) |>
  ungroup()

foul_long <- foul_summary |>
  pivot_longer(
    cols = c(mean_HF, mean_AF),
    names_to = "FoulType",
    values_to = "Fouls"
  )

foul_long <- foul_long |>
  mutate(HomeTeam = factor(HomeTeam, levels = foul_summary$HomeTeam[order(-foul_summary$discrepancy)]))

ggplot(foul_long, aes(x = HomeTeam, y = Fouls, color = FoulType, group = HomeTeam)) +
  geom_line(alpha = 0.5, linewidth = 1) +
  geom_point(size = 3) +
  scale_color_manual(
      values = c("mean_HF" = "salmon", "mean_AF" = "darkturquoise"),
      labels = c("mean_HF" = "Home Team Fouls", "mean_AF" = "Away Team Fouls")
  ) +
  labs(
    title = "Average Home vs Away Fouls",
    subtitle = "By Team",
    x = "Team",
    y = "Average Fouls",
    color = "Foul Type"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

#ggsave("our_newdumbbellplot.png")
```

After plot critique and feedback from class, we flipped coordinates of graph, changed the title to be more detailed and added subtitle that explained main takeaway. With suggestions also facet wrapped graph by whether teams had more home or away fouls. We also added alternative text and changed the bar part of the dumbbell to be a different color so it was more noticeable.

#### Final Plot 3
```{r foul-graph ggsave, fig.alt = "Dumbbell plot displaying average fouls by individual team. 11 teams foul more often when they play away and 7 teams foul more often when they play home."}
foul_summary <- season |>
  group_by(HomeTeam) |>
  summarise(
    mean_HF = mean(HF, na.rm = TRUE),
    mean_AF = mean(AF, na.rm = TRUE),
    discrepancy = abs(mean_HF - mean_AF)
  ) |>
  ungroup() |>
  mutate(foul_bias = ifelse(mean_HF > mean_AF, "More Home Fouls","More Away Fouls"))
foul_long <- foul_summary |>
  pivot_longer(
    cols = c(mean_HF, mean_AF),
    names_to = "FoulType",
    values_to = "Fouls"
  )

foul_long <- foul_long |>
  mutate(HomeTeam = factor(HomeTeam, levels = foul_summary$HomeTeam[order(-foul_summary$discrepancy)]))

ggplot(foul_long, aes(x = HomeTeam, y = Fouls, color = FoulType, group = HomeTeam)) +
  geom_line(color = "lavenderblush4", alpha = 0.5, linewidth = 1) +
  geom_point(size = 3) +
  facet_wrap(~ foul_bias, scales = "free_y") +
  scale_color_manual(
      values = c("mean_HF" = "darkturquoise", "mean_AF" = "salmon"),
      labels = c("mean_HF" = "Home Team Fouls", "mean_AF" = "Away Team Fouls")
  ) +
  labs(
    title = "Average Home vs Away Fouls by Bundesliga Soccer League Team",
    subtitle = "More teams foul more when they're away",
    x = "Team",
    y = "Average Fouls",
    color = "Foul Type"
  ) +
  coord_flip()

#ggsave("our_newdumbbellplot.png")
```

### Plot 4: Pie Chart

```{r yellow-cards pie-chart}
yellow_totals <- data.frame(
  Team = c("Away", "Home"),
  TotalYellows = c(sum(season$AY, na.rm = TRUE),
                   sum(season$HY, na.rm = TRUE))
)

ggplot(yellow_totals, aes(x = "", y = TotalYellows, fill = Team)) +
  geom_col(width = 1) +
  coord_polar("y") +
  scale_fill_manual(values = c("Away" = "salmon", "Home" = "darkturquoise")) +
  labs(
    title = "Season Total Yellow Cards",
    subtitle = "Home vs. Away Teams",
    fill = "Team"
  ) +
  theme_void()
```


```{r scatter-plot-corners}
library(dplyr)
library(tidyr)
library(ggplot2)

overall_means <- season |>
  summarise(
    avg_HC_overall = mean(HC, na.rm = TRUE),
    avg_AC_overall = mean(AC, na.rm = TRUE)
  ) |>
  pivot_longer(
    everything(),
    names_to = "Type",
    values_to = "OverallAvg"
  ) |>
  mutate(
    Type = ifelse(Type == "avg_HC_overall", "avg_HC", "avg_AC")
  )

team_data <- season |>
  summarise(avg_HC = mean(HC, na.rm = TRUE), .by = HomeTeam) |>
  rename(Team = HomeTeam) |>
  full_join(
    season |>
      summarise(avg_AC = mean(AC, na.rm = TRUE), .by = AwayTeam) |>
      rename(Team = AwayTeam),
    by = "Team"
  ) |>
  pivot_longer(
    cols = c(avg_HC, avg_AC),
    names_to = "Type",
    values_to = "AvgCorners"
  )

ggplot(team_data, aes(x = Team, y = AvgCorners)) +
  geom_point(aes(color = Type), size = 3) +
  geom_hline(data = overall_means,
             aes(yintercept = OverallAvg),
             linetype = "dashed",
             linewidth = 0.8,
             color = "black") +
  facet_wrap(~ Type, scales = "free_y") +
  scale_color_manual(
    values = c("avg_HC" = "darkturquoise", "avg_AC" = "salmon")
  ) +
  labs(
    title = "Average Corner Kicks per Team (Home vs Away)",
    x = "Team",
    y = "Average Corners"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 60, hjust = 1)) +
  coord_flip()
```

